<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>算法 | Vite-Vue-Admin</title>
    <meta name="description" content="基于Vite.js & Vue.js的管理网站">
    <link rel="preload stylesheet" href="/Interview-docs/assets/style.20ef237e.css" as="style">
    <link rel="modulepreload" href="/Interview-docs/assets/app.394bfd1d.js">
    <link rel="modulepreload" href="/Interview-docs/assets/zh-CN_guide_arithmetic.md.2e590705.lean.js">
    
    <link rel="icon" href="/logo.svg">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-94370507><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f637ee78></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-f637ee78> Skip to content </a><!--]--><!----><header class="VPNav" data-v-94370507 data-v-97571dac><div class="VPNavBar" data-v-97571dac data-v-77090745><div class="container" data-v-77090745><div class="title" data-v-77090745><div class="VPNavBarTitle" data-v-77090745 data-v-a6217f33><a class="title" href="/Interview-docs/" data-v-a6217f33><!--[--><!--]--><!--[--><img class="VPImage logo" src="/Interview-docs/logo.svg" alt data-v-dc109a54><!--]--><!--[-->Vite-Vue-Admin<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-77090745><div class="curtain" data-v-77090745></div><div class="content-body" data-v-77090745><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-77090745 data-v-066fd012><span id="main-nav-aria-label" class="visually-hidden" data-v-066fd012>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Interview-docs/zh-CN/guide/" data-v-066fd012 data-v-9d7efd51 data-v-b9e985a1><!--[-->八股文<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/Interview-docs/zh-CN/guide/arithmetic.html" data-v-066fd012 data-v-9d7efd51 data-v-b9e985a1><!--[-->基础算法<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-77090745 data-v-b8c1dd96><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-b8c1dd96 data-v-e9403e01 data-v-92d8f6fb><span class="check" data-v-92d8f6fb><span class="icon" data-v-92d8f6fb><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-e9403e01><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-e9403e01><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-77090745 data-v-c854324a data-v-b8f6762d><!--[--><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-77090745 data-v-0d671bd4 data-v-226768c1><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-226768c1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-226768c1><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-226768c1><div class="VPMenu" data-v-226768c1 data-v-e42ed9b3><!----><!--[--><!--[--><!----><div class="group" data-v-0d671bd4><div class="item appearance" data-v-0d671bd4><p class="label" data-v-0d671bd4>Appearance</p><div class="appearance-action" data-v-0d671bd4><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-0d671bd4 data-v-e9403e01 data-v-92d8f6fb><span class="check" data-v-92d8f6fb><span class="icon" data-v-92d8f6fb><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-e9403e01><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-e9403e01><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-0d671bd4><div class="item social-links" data-v-0d671bd4><div class="VPSocialLinks social-links-list" data-v-0d671bd4 data-v-b8f6762d><!--[--><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-77090745 data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-94370507 data-v-5a40893c><div class="VPDoc has-aside" data-v-5a40893c data-v-8c2b58c8><div class="container" data-v-8c2b58c8><div class="aside" data-v-8c2b58c8><div class="aside-curtain" data-v-8c2b58c8></div><div class="aside-container" data-v-8c2b58c8><div class="aside-content" data-v-8c2b58c8><div class="VPDocAside" data-v-8c2b58c8 data-v-4bd7d5c6><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-4bd7d5c6 data-v-3eaaa935><div class="content" data-v-3eaaa935><div class="outline-marker" data-v-3eaaa935></div><div class="outline-title" data-v-3eaaa935>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-3eaaa935><span class="visually-hidden" id="doc-outline-aria-label" data-v-3eaaa935> Table of Contents for current page </span><ul class="root" data-v-3eaaa935 data-v-f1f7b818><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-4bd7d5c6></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-8c2b58c8><div class="content-container" data-v-8c2b58c8><!--[--><!--]--><main class="main" data-v-8c2b58c8><div style="position:relative;" class="vp-doc _Interview-docs_zh-CN_guide_arithmetic" data-v-8c2b58c8><div><h1 id="算法" tabindex="-1">算法 <a class="header-anchor" href="#算法" aria-hidden="true">#</a></h1><h2 id="diff算法" tabindex="-1">diff算法 <a class="header-anchor" href="#diff算法" aria-hidden="true">#</a></h2><h3 id="diff-基础算法核心" tabindex="-1">diff 基础算法核心 <a class="header-anchor" href="#diff-基础算法核心" aria-hidden="true">#</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki dark-plus vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// 旧数据和新数据</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;"> = [{</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;a&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;a&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;b&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;h1&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;c&#39;</span><span style="color:#D4D4D4;">}],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;"> = [{</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;a&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;b&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;c&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;d&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;e&#39;</span><span style="color:#D4D4D4;">}]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 存储下标 键值为 key值。类型 {[key: string | number]: number}</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">idxInOld</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 声明四个变量分别是，旧前指针变量、新前指针变量、旧后指针变量、新后指针变量</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 声明新旧节点变量</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]，</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 循环</span></span>
<span class="line"><span style="color:#C586C0;">while</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 匹配规则</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">] == </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]) { </span><span style="color:#6A9955;">// 先匹配旧前和新前</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">] == </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]) { </span><span style="color:#6A9955;">// 匹配旧后和新后</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">] == </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]) { </span><span style="color:#6A9955;">// 匹配旧前和新后</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">] == </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]) { </span><span style="color:#6A9955;">// 匹配旧后和新前</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 都不满足</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 判断是否存在 oldKeyToIdx， while 第一次循环是 oldKeyToIdx 是 undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;"> === </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// 先获取所有旧数组中下标 用旧数组中 key 为键值 下标为数据值</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;"> = {}</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">; ++</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">key</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">]?.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">] = </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 查找 oldKeyToIdx 旧 Key 中是否存在 newStartNode（新前节点）key</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">idxInOld</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">];</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">idxInOld</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 说明旧中没有新节点的key就创建</span></span>
<span class="line"><span style="color:#D4D4D4;">      ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 这一步是匹配新数组中某一项在旧数组中没有</span></span>
<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#6A9955;">// 这一步是匹配旧数组中某一项在新数组中没有</span></span>
<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki dark-plus vp-code-light" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// 旧数据和新数据</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;"> = [{</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;a&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;a&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;b&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;h1&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;c&#39;</span><span style="color:#D4D4D4;">}],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;"> = [{</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;a&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;b&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;c&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;d&#39;</span><span style="color:#D4D4D4;">}, {</span><span style="color:#9CDCFE;">sel:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;e&#39;</span><span style="color:#D4D4D4;">}]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 存储下标 键值为 key值。类型 {[key: string | number]: number}</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">idxInOld</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 声明四个变量分别是，旧前指针变量、新前指针变量、旧后指针变量、新后指针变量</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 声明新旧节点变量</span></span>
<span class="line"><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]，</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 循环</span></span>
<span class="line"><span style="color:#C586C0;">while</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 匹配规则</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">] == </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]) { </span><span style="color:#6A9955;">// 先匹配旧前和新前</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">] == </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]) { </span><span style="color:#6A9955;">// 匹配旧后和新后</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">] == </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]) { </span><span style="color:#6A9955;">// 匹配旧前和新后</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">] == </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]) { </span><span style="color:#6A9955;">// 匹配旧后和新前</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldEndNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 都不满足</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 判断是否存在 oldKeyToIdx， while 第一次循环是 oldKeyToIdx 是 undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;"> === </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// 先获取所有旧数组中下标 用旧数组中 key 为键值 下标为数据值</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;"> = {}</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">; ++</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">key</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldChildren</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">]?.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">] = </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 查找 oldKeyToIdx 旧 Key 中是否存在 newStartNode（新前节点）key</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">idxInOld</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldKeyToIdx</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">];</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">idxInOld</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 说明旧中没有新节点的key就创建</span></span>
<span class="line"><span style="color:#D4D4D4;">      ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newStartNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newChildren</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 这一步是匹配新数组中某一项在旧数组中没有</span></span>
<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newStartIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#6A9955;">// 这一步是匹配旧数组中某一项在新数组中没有</span></span>
<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldStartIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIndex</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    ... </span><span style="color:#6A9955;">// 逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="diff算法中的-vnode-手写步骤" tabindex="-1">diff算法中的 <code>vnode</code> (手写步骤) <a class="header-anchor" href="#diff算法中的-vnode-手写步骤" aria-hidden="true">#</a></h3><br><p><strong>1. 定义一个函数生成 <code>vnode</code> 数据结构</strong></p><details><summary>展开查看</summary><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki dark-plus vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">interface</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">[];</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  [</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">]: </span><span style="color:#4EC9B0;">any</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">interface</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[];</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;key&#39;</span><span style="color:#D4D4D4;">];</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 生成虚拟节点结构</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">data</span><span style="color:#6A9955;"> 虚拟节点数据</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#6A9955;"> 虚拟节点子集</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">text</span><span style="color:#6A9955;"> 虚拟节点内容</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">elm</span><span style="color:#6A9955;"> 真实节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * vnode(&#39;div&#39;, {key: &#39;a&#39;}, undefined, &#39;Hello World&#39;, undefined)</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@returns</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">:</span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;"> = {}, </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">:</span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;children&#39;</span><span style="color:#D4D4D4;">]  = </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;text&#39;</span><span style="color:#D4D4D4;">] = </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">:</span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;elm&#39;</span><span style="color:#D4D4D4;">] = </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">key</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki dark-plus vp-code-light" tabindex="0"><code><span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">interface</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">[];</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  [</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">]: </span><span style="color:#4EC9B0;">any</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">interface</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[];</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;key&#39;</span><span style="color:#D4D4D4;">];</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 生成虚拟节点结构</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">data</span><span style="color:#6A9955;"> 虚拟节点数据</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#6A9955;"> 虚拟节点子集</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">text</span><span style="color:#6A9955;"> 虚拟节点内容</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">elm</span><span style="color:#6A9955;"> 真实节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * vnode(&#39;div&#39;, {key: &#39;a&#39;}, undefined, &#39;Hello World&#39;, undefined)</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@returns</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">:</span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;"> = {}, </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">:</span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;children&#39;</span><span style="color:#D4D4D4;">]  = </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;text&#39;</span><span style="color:#D4D4D4;">] = </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">:</span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;elm&#39;</span><span style="color:#D4D4D4;">] = </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">key</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></details><p><strong>2. 定义一个 h 函数通过传参生成 <code>vnode</code> 数据结构</strong></p><details><summary>展开查看</summary><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki dark-plus vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * h 函数</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@author</span><span style="color:#6A9955;">: peng-xiao-shuai</span></span>
<span class="line"><span style="color:#6A9955;"> * @date: 2023-03-30 12:26:14</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@last</span><span style="color:#6A9955;"> Modified by: peng-xiao-shuai</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@last</span><span style="color:#6A9955;"> Modified time: 2023-03-30 12:26:14</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">VNodeData</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;./vnode&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">type</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNodeElem</span><span style="color:#D4D4D4;"> = </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">null</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">undefined</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">type</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNodeContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#4EC9B0;">VNodeElem</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">VNodeElem</span><span style="color:#D4D4D4;">[]</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名称</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;)</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名称</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNodeData}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">data</span><span style="color:#6A9955;"> 虚拟节点数据</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;, {key: &#39;1&#39;})</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名称</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNodeContent}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">content</span><span style="color:#6A9955;"> 虚拟节点内容数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;, &#39;Hello World&#39;)</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;, [&#39;Hello World&#39;, 1, h(&#39;span&#39;, 1)])</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeContent</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名称</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNodeData}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">data</span><span style="color:#6A9955;"> 虚拟节点数据</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNodeContent}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">content</span><span style="color:#6A9955;"> 虚拟节点内容数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;, {key: &#39;1&#39;}, &#39;Hello World&#39;)</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeContent</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">any</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">any</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> == </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">error</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`sel 不能为 &quot;&quot;`</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;"> = {},</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;children&#39;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;text&#39;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;elm&#39;</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">    if 判断是否对象并且不为 null</span></span>
<span class="line"><span style="color:#6A9955;">      if 判断是否是数组</span></span>
<span class="line"><span style="color:#6A9955;">        数组类型直接赋值给 children = d</span></span>
<span class="line"><span style="color:#6A9955;">      else if 是否存在 sel（标签）参数</span></span>
<span class="line"><span style="color:#6A9955;">        存在说明是 VNodeContent 类型 children = [d]</span></span>
<span class="line"><span style="color:#6A9955;">      else 否则则是 直接赋值给 data = d</span></span>
<span class="line"><span style="color:#6A9955;">    else 不是对象则赋值给 text = d</span></span>
<span class="line"><span style="color:#6A9955;">    */</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">typeof</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;"> == </span><span style="color:#CE9178;">&#39;object&#39;</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">Array</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isArray</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;">)) {  </span><span style="color:#6A9955;">// 满足说明 d 是 VNodeContent 类型</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">d</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">){ </span><span style="color:#6A9955;">// 满足说明 d 是 VNodeContent 类型否则就是 VNodeData</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = [</span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">d</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// d 是内容</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">d</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">d</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">typeof</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;"> == </span><span style="color:#CE9178;">&#39;object&#39;</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">Array</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isArray</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">)) {  </span><span style="color:#6A9955;">// 满足说明 c 是 VNodeContent 类型</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">c</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 满足说明 c 是 VNodeContent</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = [</span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// c 是内容</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">c</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 此时的 children 可能为 (number | string | object)[]</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">typeof</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">] !== </span><span style="color:#CE9178;">&#39;object&#39;</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">] = </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, {}, </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">] </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">any</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki dark-plus vp-code-light" tabindex="0"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * h 函数</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@author</span><span style="color:#6A9955;">: peng-xiao-shuai</span></span>
<span class="line"><span style="color:#6A9955;"> * @date: 2023-03-30 12:26:14</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@last</span><span style="color:#6A9955;"> Modified by: peng-xiao-shuai</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@last</span><span style="color:#6A9955;"> Modified time: 2023-03-30 12:26:14</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">VNodeData</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;./vnode&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">type</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNodeElem</span><span style="color:#D4D4D4;"> = </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">null</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">undefined</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">type</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNodeContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#4EC9B0;">VNodeElem</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">VNodeElem</span><span style="color:#D4D4D4;">[]</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名称</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;)</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名称</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNodeData}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">data</span><span style="color:#6A9955;"> 虚拟节点数据</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;, {key: &#39;1&#39;})</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名称</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNodeContent}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">content</span><span style="color:#6A9955;"> 虚拟节点内容数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;, &#39;Hello World&#39;)</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;, [&#39;Hello World&#39;, 1, h(&#39;span&#39;, 1)])</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeContent</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#6A9955;"> 标签名称</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNodeData}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">data</span><span style="color:#6A9955;"> 虚拟节点数据</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNodeContent}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">content</span><span style="color:#6A9955;"> 虚拟节点内容数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * h(&#39;div&#39;, {key: &#39;1&#39;}, &#39;Hello World&#39;)</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">VNodeContent</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">h</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">any</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">?: </span><span style="color:#4EC9B0;">any</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> == </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">error</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`sel 不能为 &quot;&quot;`</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;"> = {},</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;children&#39;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;text&#39;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[</span><span style="color:#CE9178;">&#39;elm&#39;</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">    if 判断是否对象并且不为 null</span></span>
<span class="line"><span style="color:#6A9955;">      if 判断是否是数组</span></span>
<span class="line"><span style="color:#6A9955;">        数组类型直接赋值给 children = d</span></span>
<span class="line"><span style="color:#6A9955;">      else if 是否存在 sel（标签）参数</span></span>
<span class="line"><span style="color:#6A9955;">        存在说明是 VNodeContent 类型 children = [d]</span></span>
<span class="line"><span style="color:#6A9955;">      else 否则则是 直接赋值给 data = d</span></span>
<span class="line"><span style="color:#6A9955;">    else 不是对象则赋值给 text = d</span></span>
<span class="line"><span style="color:#6A9955;">    */</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">typeof</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;"> == </span><span style="color:#CE9178;">&#39;object&#39;</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">Array</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isArray</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;">)) {  </span><span style="color:#6A9955;">// 满足说明 d 是 VNodeContent 类型</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">d</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">){ </span><span style="color:#6A9955;">// 满足说明 d 是 VNodeContent 类型否则就是 VNodeData</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = [</span><span style="color:#9CDCFE;">d</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">d</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// d 是内容</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">d</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">d</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">typeof</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;"> == </span><span style="color:#CE9178;">&#39;object&#39;</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">Array</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isArray</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">)) {  </span><span style="color:#6A9955;">// 满足说明 c 是 VNodeContent 类型</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">c</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 满足说明 c 是 VNodeContent</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = [</span><span style="color:#9CDCFE;">c</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// c 是内容</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">c</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 此时的 children 可能为 (number | string | object)[]</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">typeof</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">] !== </span><span style="color:#CE9178;">&#39;object&#39;</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">] = </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, {}, </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">] </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">any</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></details><p><strong>3. 定义一个创建虚拟节点转换函数 <code>elemToVNode</code> （作用：将真实节点转换虚拟节点</strong></p><details><summary>展开查看</summary><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki dark-plus vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">VNodeData</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./vnode&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 类型保护</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">isElement</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;">): </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Element</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeType</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 真实节点转换虚拟节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{Node}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">node</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * elemToVNode(document.getElementById(&quot;app&quot;)!)</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@returns</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">elemToVNode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">childNodes</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[] | </span><span style="color:#4EC9B0;">undefined</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;">// 虚拟节点子集</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 对子集数据操作</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;"> = []</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">of</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeType</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 标签节点进行再次判断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// 标签节点下存在文字时 标签节点下将会有一个text子节点，这种情况下子节点将不需要，值直接放在 text中</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">childNodes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">childNodes</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">nodeType</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">((&lt;</span><span style="color:#4EC9B0;">Element</span><span style="color:#D4D4D4;">&gt;</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">).</span><span style="color:#9CDCFE;">tagName</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toLowerCase</span><span style="color:#D4D4D4;">(), {}, </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">childNodes</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">!.</span><span style="color:#DCDCAA;">trim</span><span style="color:#D4D4D4;">(), </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 递归函数</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">elemToVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">)!)</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeType</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">!.</span><span style="color:#DCDCAA;">trim</span><span style="color:#D4D4D4;">() != </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 文本节点直接添加到子集数组中</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, {}, </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">!.</span><span style="color:#DCDCAA;">trim</span><span style="color:#D4D4D4;">(), </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// console.log(&#39;其他类型或者值为空&#39;, element.nodeType, element.nodeValue);</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 对当前 node 进行操作</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">isElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 获取标签名和id、class属性</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">tagName</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toLowerCase</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">data</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;"> = {}</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">cl</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;class&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 获取id</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// sel += &#39;#&#39; + node.id</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">id</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 获取class名称</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">cl</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// sel += &quot;.&quot; + cl.split(&quot; &quot;).join(&quot;.&quot;)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">cl</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">split</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39; &#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">node</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      {},</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">node</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      {},</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">node</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki dark-plus vp-code-light" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">VNodeData</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./vnode&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 类型保护</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">isElement</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;">): </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Element</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeType</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 真实节点转换虚拟节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{Node}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">node</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * elemToVNode(document.getElementById(&quot;app&quot;)!)</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@returns</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">elemToVNode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">childNodes</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[] | </span><span style="color:#4EC9B0;">undefined</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;"> </span><span style="color:#6A9955;">// 虚拟节点子集</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 对子集数据操作</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;"> = []</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">of</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeType</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 标签节点进行再次判断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// 标签节点下存在文字时 标签节点下将会有一个text子节点，这种情况下子节点将不需要，值直接放在 text中</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">childNodes</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">childNodes</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">nodeType</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">((&lt;</span><span style="color:#4EC9B0;">Element</span><span style="color:#D4D4D4;">&gt;</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">).</span><span style="color:#9CDCFE;">tagName</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toLowerCase</span><span style="color:#D4D4D4;">(), {}, </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">childNodes</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">!.</span><span style="color:#DCDCAA;">trim</span><span style="color:#D4D4D4;">(), </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 递归函数</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">elemToVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">)!)</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeType</span><span style="color:#D4D4D4;"> == </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">!.</span><span style="color:#DCDCAA;">trim</span><span style="color:#D4D4D4;">() != </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 文本节点直接添加到子集数组中</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">push</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, {}, </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">element</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">!.</span><span style="color:#DCDCAA;">trim</span><span style="color:#D4D4D4;">(), </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// console.log(&#39;其他类型或者值为空&#39;, element.nodeType, element.nodeValue);</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 对当前 node 进行操作</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">isElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 获取标签名和id、class属性</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">tagName</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toLowerCase</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">data</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNodeData</span><span style="color:#D4D4D4;"> = {}</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">cl</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;class&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 获取id</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// sel += &#39;#&#39; + node.id</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">id</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 获取class名称</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">cl</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// sel += &quot;.&quot; + cl.split(&quot; &quot;).join(&quot;.&quot;)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">cl</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">split</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39; &#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">vNodeChildren</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">node</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      {},</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">nodeValue</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">node</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">vnode</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      {},</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">node</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></details><p><strong>4. 定义一个创建真实节点转换函数 <code>createElem</code> （作用：将虚拟节点转换真实节点）</strong></p><details><summary>展开查看</summary><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki dark-plus vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">VNodeData</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./vnode&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 虚拟节点创建真实节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">vnode</span><span style="color:#6A9955;"> 虚拟节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * createElem(h(&#39;div&#39;, {}, [&#39;1&#39;, h(&#39;span&#39;, &#39;span&#39;)]))</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@returns</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{HTMLElement}</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">HTMLElement</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">domNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">id</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">className</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">join</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39; &#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 递归将children改为真实节点</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">?.</span><span style="color:#DCDCAA;">forEach</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createTextNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">!))</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 这里直接使用 domNode.textContent</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">domNode</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki dark-plus vp-code-light" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">VNodeData</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./vnode&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 虚拟节点创建真实节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">vnode</span><span style="color:#6A9955;"> 虚拟节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * createElem(h(&#39;div&#39;, {}, [&#39;1&#39;, h(&#39;span&#39;, &#39;span&#39;)]))</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@returns</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{HTMLElement}</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">HTMLElement</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">domNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">id</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">className</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">?.</span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">join</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39; &#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 递归将children改为真实节点</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">?.</span><span style="color:#DCDCAA;">forEach</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createTextNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">!))</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 这里直接使用 domNode.textContent</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">domNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">vnode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">domNode</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></details><p><strong>5. 定义一个 patchVNode 函数 （作用：比较两个虚拟节点）</strong></p><ul><li>如果连个节点完全一样则退出函数</li><li>判断 <code>oldVNode.elm</code> 是否存在，没有则创建真实节点赋值给 <code>elm</code></li><li>将 <code>oldVNode.elm</code> 赋值给 <code>newVNode.elm</code></li><li>判断 <code>newVNode.text</code> 是否存在</li><li><ul><li>存在则将 <code>newVNode.text</code> 赋值给 <code>newVNode.elm.textContent</code></li></ul></li><li>否则继续判断（<code>else if</code>判断）旧节点和新节点是否都存在子集</li><li><ul><li>存在则进入 <code>diffVNode</code> 函数</li></ul></li><li>否则继续判断新节点是否存在子集</li><li><ul><li>存在将 <code>newVNode.elm</code> 清空（这里清空 <code>newVNode.elm</code> 是因为在上面，<code>newVNode.elm</code> 值是 <code>oldVNode.elm</code> 赋值的），在循环<code>newVNode.children</code> 给 <code>newVNode.elm</code> 添加子集</li></ul></li><li><code>else</code> 以上都不满足则进入文字替换，将 <code>newVNode.text</code> 赋值给 <code>newVNode.elm.textContent</code></li></ul><details><summary>展开查看</summary><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki dark-plus has-diff vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">createElem</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./transform&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./vnode&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;"> = &lt;</span><span style="color:#4EC9B0;">T</span><span style="color:#D4D4D4;">&gt;(</span><span style="color:#9CDCFE;">val</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">T</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">val</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 比较虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#6A9955;"> 旧的虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#6A9955;"> 新的虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;"> === </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 一样直接退出</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 避免oldVNode.elm 不存在的情况</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">)) {  </span><span style="color:#6A9955;">// 是否有text存在则将旧节点的textContent替换</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">!</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">) &amp;&amp; </span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 都存在子集交给diff去判断</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">diffVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!, </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">!, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧节点不存在子集 新节点存在，添加子集</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">?.</span><span style="color:#DCDCAA;">forEach</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">elem</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">elem</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">    })</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 文字替换</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">!</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki dark-plus has-diff vp-code-light" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">createElem</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./transform&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./vnode&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;"> = &lt;</span><span style="color:#4EC9B0;">T</span><span style="color:#D4D4D4;">&gt;(</span><span style="color:#9CDCFE;">val</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">T</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">val</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 比较虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#6A9955;"> 旧的虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#6A9955;"> 新的虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;"> === </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 一样直接退出</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// 避免oldVNode.elm 不存在的情况</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">)) {  </span><span style="color:#6A9955;">// 是否有text存在则将旧节点的textContent替换</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">!</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">) &amp;&amp; </span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 都存在子集交给diff去判断</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">diffVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!, </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">!, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">isDef</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧节点不存在子集 新节点存在，添加子集</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">children</span><span style="color:#D4D4D4;">?.</span><span style="color:#DCDCAA;">forEach</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">elem</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">elem</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">    })</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 文字替换</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">!</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></details><p><strong>6. 定义一个 <code>diffVNode</code> 函数（也就是 <code>diff</code> 算法，去比较子节点，结合 <code>diff</code> 基础核心进行阅读）</strong></p><details><summary>展开查看</summary><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki dark-plus has-diff vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// 我这里是将 diffVNode、patch、patchVNode、sameVnode、isDef、isVNode放在一个函数所以，没有使用import</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * diff 节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{Node}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#6A9955;"> oldCh数组的父级真实节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{(VNode|undefined)[]}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#6A9955;"> 旧的虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode[]}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">newCh</span><span style="color:#6A9955;"> 新的虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">diffVNode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">: (</span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">|</span><span style="color:#4EC9B0;">undefined</span><span style="color:#D4D4D4;">)[], </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[]) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 定义指针</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 定义节点</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldKeyMap</span><span style="color:#D4D4D4;">: {[</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;">]: </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;">} = {}</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">undefined</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">while</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧前undefined&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧前新前</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧前新前&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧后新后</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧后新后&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧前新后</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧前新后&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!, </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧后新前</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧后新前&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!, </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;都不满足&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldKeyMap</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// while 循环时第一次必定为 undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">forEach</span><span style="color:#D4D4D4;">((</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">index</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) </span><span style="color:#9CDCFE;">oldKeyMap</span><span style="color:#D4D4D4;">![</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">] = </span><span style="color:#9CDCFE;">index</span></span>
<span class="line"><span style="color:#D4D4D4;">        })</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> ? </span><span style="color:#9CDCFE;">oldKeyMap</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">] : </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">]?.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> == </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// sel 相同则不进行在创建标签</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">]!, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">]?.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!, </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">), </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">] = </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">), </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">before</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">] ? </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">! : </span><span style="color:#569CD6;">null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">]), </span><span style="color:#9CDCFE;">before</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">removeChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">]?.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki dark-plus has-diff vp-code-light" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// 我这里是将 diffVNode、patch、patchVNode、sameVnode、isDef、isVNode放在一个函数所以，没有使用import</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * diff 节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{Node}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#6A9955;"> oldCh数组的父级真实节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{(VNode|undefined)[]}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#6A9955;"> 旧的虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{VNode[]}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">newCh</span><span style="color:#6A9955;"> 新的虚拟节点数组</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">diffVNode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">: (</span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">|</span><span style="color:#4EC9B0;">undefined</span><span style="color:#D4D4D4;">)[], </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">[]) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 定义指针</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 定义节点</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldKeyMap</span><span style="color:#D4D4D4;">: {[</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;">]: </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;">} = {}</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">number</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">undefined</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">while</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧前undefined&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧前新前</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧前新前&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧后新后</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧后新后&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧前新后</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧前新后&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!, </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 旧后新前</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;旧后新前&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!, </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldEndVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[--</span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// console.log(&#39;都不满足&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldKeyMap</span><span style="color:#D4D4D4;"> == </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// while 循环时第一次必定为 undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">forEach</span><span style="color:#D4D4D4;">((</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">index</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span><span style="color:#D4D4D4;">) </span><span style="color:#9CDCFE;">oldKeyMap</span><span style="color:#D4D4D4;">![</span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">] = </span><span style="color:#9CDCFE;">index</span></span>
<span class="line"><span style="color:#D4D4D4;">        })</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> ? </span><span style="color:#9CDCFE;">oldKeyMap</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">] : </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">]?.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> == </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;">) { </span><span style="color:#6A9955;">// sel 相同则不进行在创建标签</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">]!, </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">]?.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!, </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">), </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">oldInIdx</span><span style="color:#D4D4D4;">] = </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;">), </span><span style="color:#9CDCFE;">oldStartVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">newStartVNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[++</span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">before</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">] ? </span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">].</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">! : </span><span style="color:#569CD6;">null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">newStartIdx</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">newEndIdx</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">]), </span><span style="color:#9CDCFE;">before</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#569CD6;">let</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldStartIdx</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> &lt;= </span><span style="color:#9CDCFE;">oldEndIdx</span><span style="color:#D4D4D4;">; </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">++) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">parentElm</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">removeChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldCh</span><span style="color:#D4D4D4;">[</span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;">]?.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!)</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></details><p><strong>7. 定义 <code>patch</code> 函数去比较传入的值 （ <code>patch</code> 函数接收两个参数，一个旧节点，一个新节点）</strong></p><p><code>patch</code> 函数逻辑</p><ul><li>如果旧节点参数是真实节点，则将真实节点转换为虚拟节点 （当旧节点和新节点都是虚拟节点时去比较两个节点不同）</li></ul><p><em><code>oldNode newNode</code> 都是虚拟节点后：</em></p><ul><li>两个节点一样时（简单判断的话可以判断两个节点的 <code>sel</code> 和 <code>key</code> 是否相等,相等则一样） 节点一样将旧节点的elm赋值给新节点的elm属性，在执行 <code>patchVNode</code> 函数</li><li><code>else</code> 给 <code>newNode.elm</code> 赋值真实节点（真实节点由 <code>createElem(newVNode)</code> 创建），通过旧节点获取父级节点在通过父级节点的 <code>insertBefore</code> 函数将新节点移动到旧节点位置，在删除旧节点。</li></ul><p><em>return <code>newNode.elm</code> （ <code>elm</code> 为真实节点）</em></p><details><summary>展开查看</summary><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki dark-plus vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">createElem</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">elemToVNode</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./transform&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./vnode&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">isSel</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> == </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">isKey</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> == </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">isSel</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">isKey</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">isVNode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Element</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">): </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> (&lt;</span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">&gt;</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">).</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 替换节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{Element | Node | VNode}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">oldNode</span><span style="color:#6A9955;"> 旧节点(如果旧节点为虚拟节点，那么旧节点将不会渲染到页面)</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#6A9955;"> 新虚拟节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * patch(document.getElementById(&quot;app&quot;)!, h(&#39;h1&#39;, {id: &#39;a&#39;}, 121))</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@returns</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{Node}</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">patch</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Element</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#DCDCAA;">isVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">elemToVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 创建新节点</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">oldElm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 标签 和 key 相同情况</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldElm</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 不同直接删除和新增节点</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// console.log(&#39;标签或key不同&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 将新节点移动到旧节点位置</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldElm</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">parentNode</span><span style="color:#D4D4D4;">?.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">oldElm</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldElm</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">parentNode</span><span style="color:#D4D4D4;">?.</span><span style="color:#DCDCAA;">removeChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldElm</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki dark-plus vp-code-light" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">createElem</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">elemToVNode</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./transform&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">VNode</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;./vnode&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">isSel</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> == </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">sel</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">isKey</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> == </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">isSel</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">isKey</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">isVNode</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Element</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">): </span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> (&lt;</span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">&gt;</span><span style="color:#9CDCFE;">node</span><span style="color:#D4D4D4;">).</span><span style="color:#9CDCFE;">sel</span><span style="color:#D4D4D4;"> !== </span><span style="color:#569CD6;">undefined</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;"> * 替换节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{Element | Node | VNode}</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">oldNode</span><span style="color:#6A9955;"> 旧节点(如果旧节点为虚拟节点，那么旧节点将不会渲染到页面)</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#6A9955;"> 新虚拟节点</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@example</span></span>
<span class="line"><span style="color:#6A9955;"> * patch(document.getElementById(&quot;app&quot;)!, h(&#39;h1&#39;, {id: &#39;a&#39;}, 121))</span></span>
<span class="line"><span style="color:#6A9955;"> * </span><span style="color:#569CD6;">@returns</span><span style="color:#6A9955;"> </span><span style="color:#4EC9B0;">{Node}</span></span>
<span class="line"><span style="color:#6A9955;"> */</span></span>
<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">patch</span><span style="color:#D4D4D4;"> = (</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">Element</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">VNode</span><span style="color:#D4D4D4;">): </span><span style="color:#4EC9B0;">Node</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#DCDCAA;">isVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">elemToVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 创建新节点</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">oldElm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">sameVnode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">)) { </span><span style="color:#6A9955;">// 标签 和 key 相同情况</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">oldElm</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">patchVNode</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldNode</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> { </span><span style="color:#6A9955;">// 不同直接删除和新增节点</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// console.log(&#39;标签或key不同&#39;);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createElem</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 将新节点移动到旧节点位置</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldElm</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">parentNode</span><span style="color:#D4D4D4;">?.</span><span style="color:#DCDCAA;">insertBefore</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">oldElm</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">oldElm</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">parentNode</span><span style="color:#D4D4D4;">?.</span><span style="color:#DCDCAA;">removeChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">oldElm</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">newVNode</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">elm</span><span style="color:#D4D4D4;">!</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div></details><p><code>vnode</code> 新老节点完全替换规则</p><ol><li>没有 <code>key</code> 并且 <code>sel 标签</code> 不同则暴力删除和新增</li></ol></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-8c2b58c8 data-v-ba0c6c51><div class="edit-info" data-v-ba0c6c51><div class="edit-link" data-v-ba0c6c51><a class="VPLink link edit-link-button" href="https://github.com/peng-xiao-shuai/vite-vue-admin-docs/edit/main/zh-CN/guide/arithmetic.md" target="_blank" rel="noreferrer" data-v-ba0c6c51 data-v-b9e985a1><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" data-v-ba0c6c51><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 帮助我们改善此页面！<!--]--><!----></a></div><div class="last-updated" data-v-ba0c6c51><p class="VPLastUpdated" data-v-ba0c6c51 data-v-4678a00d>最后更新时间: <time datetime="2023-04-19T07:44:46.000Z" data-v-4678a00d></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter" data-v-94370507 data-v-337c2740><div class="container" data-v-337c2740><p class="message" data-v-337c2740>Released under the MIT License.</p><!----></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"zh-cn_component_powerful-table-demo.md\":\"1636c90b\",\"zh-cn_component_powerful-table-doc.md\":\"34a78835\",\"index.md\":\"37d00ab3\",\"zh-cn_guide_index.md\":\"0e242c78\",\"readme.md\":\"02202747\",\"zh-cn_guide_arithmetic.md\":\"2e590705\"}")</script>
    <script type="module" async src="/Interview-docs/assets/app.394bfd1d.js"></script>
    
  </body>
</html>